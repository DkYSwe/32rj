async function fetchQuote() {
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyP9WYlCEs0-QyPJ0zdEUDEdlRT3meGiTfmPl_kTwxBFzlecz1eZOuxBJxKyIe9h08akg/exec"; 
    const params = new URLSearchParams(window.location.search);
    
    // 1. Set Local Defaults for Frontend Logic
    const guiParam = params.get('gui') || 'text'; // Default to text
    const isTextMode = guiParam === 'text';

    try {
        const response = await fetch(`${SCRIPT_URL}?${params.toString()}`, { 
            method: 'GET',
            redirect: 'follow' 
        });

        // 2. COMPLETE TEXT OUTPUT
        if (isTextMode) {
            const rawText = await response.text();
            // Completely wipe document and write only the raw text
            document.open();
            document.write(`<pre style="font-family:monospace; white-space:pre-wrap; padding:20px; font-size:1.2rem; line-height:1.6;">${rawText}</pre>`);
            document.close();
            return;
        }

        // 3. GUI OUTPUT (gui=yes)
        const data = await response.json();
        if (data.error) {
            document.getElementById('quote').innerHTML = `<span style="color:red">${data.error}</span>`;
        } else {
            // Apply colors and visibility settings
            if (params.get('colors') === 'yes') document.body.classList.add('color-mode');
            if (params.get('author') === 'no') document.getElementById('gui-elements').style.display = 'none';

            document.getElementById('quote').innerHTML = data.quote.replace(/([,.;!?])\s*/g, '$1<br>');
            if (data.author) document.getElementById('author').innerText = "â€” " + data.author;
        }
    } catch (err) {
        if (!isTextMode) document.getElementById('quote').innerText = "Connection Error.";
    }
}
fetchQuote()
