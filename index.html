async function fetchQuote() {
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyP9WYlCEs0-QyPJ0zdEUDEdlRT3meGiTfmPl_kTwxBFzlecz1eZOuxBJxKyIe9h08akg/exec"; 
    const params = new URLSearchParams(window.location.search);
    const isTextOnly = params.get('gui') === 'text';
    const showAuthor = params.get('author') !== 'no';

    if (isTextOnly) {
        document.getElementById('app').style.display = 'none';
        document.body.innerHTML = ''; 
    } else {
        // Standard Theme Colors
        if (params.get('colors') === 'no') document.body.classList.add('bw-mode');
        else if (params.get('colors') === 'yes') document.body.classList.add('color-mode');
        
        // Hide GUI author elements early if author=no
        if (!showAuthor) {
            document.getElementById('gui-elements').style.display = 'none';
        }
    }

    try {
        const response = await fetch(`${SCRIPT_URL}?${params.toString()}`, { redirect: "follow" });

        if (isTextOnly) {
            const rawText = await response.text();
            document.open();
            document.write(`<pre style="font-family: monospace; white-space: pre-wrap; padding: 20px;">${rawText}</pre>`);
            document.close();
            return;
        }

        const data = await response.json();
        if (data.error) {
            document.getElementById('quote').innerHTML = `<span style="color:red">${data.error}</span>`;
        } else {
            // Apply line breaks to quote
            document.getElementById('quote').innerHTML = data.quote.replace(/([,.;!?])\s*/g, '$1<br>');
            
            // Set author if available in the JSON response
            if (data.author) {
                document.getElementById('author').innerText = "â€” " + data.author;
            }
        }
    } catch (err) {
        if (!isTextOnly) document.getElementById('quote').innerText = "Connection Error.";
    }
}
